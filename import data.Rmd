---
title: "import data"
author: "Catherine DiGennaro"
date: "5/3/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

- all data available from [NBER](https://www.nber.org/research/data/mortality-data-vital-statistics-nchs-multiple-cause-death-data)
- all data theoretically available from [CDC/NCHS](https://www.cdc.gov/nchs/data_access/vitalstatsonline.htm), but something is wrong with 2018 data

Import all data
```{r}
files <- Sys.glob("Data_NBER/*")
print(files)
for(i in files) {
  filename <- paste0("deaths_", str_extract(i, "[:digit:]+"))
  # print(filename)
  assign(filename, read.csv(i))
}
```

```{r}
# ICD-10 codes indicating OD as underlying cause of death
UCOD_OD_codes <- c("X40","X41","X42","X43","X44",
                   "X60","X61","X62","X63","X64",
                   "X85",
                   "Y10","Y11","Y12","Y13","Y14")

# filter down to only OD deaths, keep sex, age, place of death, race/ethnicity, year, and all assigned ICD-10 codes
ODs_11 <- deaths_2011 %>% 
  filter(ucod %in% UCOD_OD_codes) %>% 
  select(sex, age, ager52, placdth, record_1:record_20, race, hispanic, year)

ODs_12 <- deaths_2012 %>% 
  filter(ucod %in% UCOD_OD_codes) %>% 
  select(sex, age, ager52, placdth, record_1:record_20, race, hispanic, year)

ODs_13 <- deaths_2013 %>% 
  filter(ucod %in% UCOD_OD_codes) %>% 
  select(sex, age, ager52, placdth, record_1:record_20, race, hispanic, year)

ODs_14 <- deaths_2014 %>% 
  filter(ucod %in% UCOD_OD_codes) %>% 
  select(sex, age, ager52, placdth, record_1:record_20, race, hispanic, year)

ODs_15 <- deaths_2015 %>% 
  filter(ucod %in% UCOD_OD_codes) %>% 
  select(sex, age, ager52, placdth, record_1:record_20, race, hispanic, year)

ODs_16 <- deaths_2016 %>% 
  filter(ucod %in% UCOD_OD_codes) %>% 
  select(sex, age, ager52, placdth, record_1:record_20, race, hispanic, year)

ODs_17 <- deaths_2017 %>% 
  filter(ucod %in% UCOD_OD_codes) %>% 
  select(sex, age, ager52, placdth, record_1:record_20, race, hispanic, year)

ODs_18 <- deaths_2018 %>% 
  filter(ucod %in% UCOD_OD_codes) %>% 
  select(sex, age, ager52, placdth, record_1:record_20, race, hispanic, year)

ODs_19 <- deaths_2019 %>% 
  filter(ucod %in% UCOD_OD_codes) %>% 
  select(sex, age, ager52, placdth, record_1:record_20, race, hispanic, year)
```

```{r}
#merge into one dataset and save
all_ODs <- rbind(ODs_11,
                 ODs_12,
                 ODs_13,
                 ODs_14,
                 ODs_15,
                 ODs_16,
                 ODs_17,
                 ODs_18,
                 ODs_19) 
write.csv(all_ODs, "NCHS_all_ODs.csv")
```

